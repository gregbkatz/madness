<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>March Madness Bracket v1.2</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-bracket/0.11.1/jquery.bracket.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-bracket/0.11.1/jquery.bracket.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.4;
            padding: 5px;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            padding: 0;
        }

        header {
            text-align: center;
            margin-bottom: 5px;
        }

        h1 {
            color: #0057b7;
            margin-bottom: 0;
            font-size: 20px;
        }

        .instructions {
            text-align: center;
            font-size: 11px;
            color: #666;
            margin-bottom: 10px;
        }

        /* Unified tournament bracket layout */
        .tournament-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto auto auto;
            grid-template-areas:
                "west east"
                "center center"
                "south midwest";
            gap: 1px;
            margin: 0 auto;
        }

        .west-region {
            grid-area: west;
        }

        .east-region {
            grid-area: east;
        }

        .south-region {
            grid-area: south;
        }

        .midwest-region {
            grid-area: midwest;
        }

        .center-area {
            grid-area: center;
            margin: 0 auto;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
            position: relative;
        }

        .region-title {
            text-align: center;
            font-size: 14px;
            font-weight: bold;
            color: #0057b7;
            margin-bottom: 0;
        }

        .bracket {
            overflow-x: visible;
            padding: 0;
        }

        /* Final Four custom layout */
        .final-four-layout {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            position: relative;
            margin-top: 10px;
        }

        .final-four-team {
            background-color: #f5f8ff;
            border: 1px solid #ddd;
            padding: 2px 4px;
            width: 90px;
            font-size: 10px;
            margin: 1px 0;
            cursor: pointer;
        }

        .final-four-team.winner {
            background-color: #e3f2fd;
            font-weight: bold;
            border-left: 2px solid #0057b7;
        }

        .final-four-team.right.winner {
            border-left: none;
            border-right: 2px solid #0057b7;
        }

        .final-four-matchup {
            display: flex;
            flex-direction: column;
        }

        .final-four-matchup.left {
            margin-right: 40px;
        }

        .final-four-matchup.right {
            margin-left: 40px;
        }

        .championship-matchup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 10;
        }

        .champion-display {
            margin-top: 8px;
            text-align: center;
            font-weight: bold;
            font-size: 11px;
            color: #c47c00;
            padding: 3px 6px;
            background-color: #fff8e0;
            border: 1px solid #f0d78c;
            border-radius: 3px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .connector-horizontal {
            position: absolute;
            height: 2px;
            background-color: #0057b7;
            top: 50%;
        }

        .connector-left {
            right: 50%;
            width: 40px;
            margin-right: 45px;
        }

        .connector-right {
            left: 50%;
            width: 40px;
            margin-left: 45px;
        }

        .connector-vertical {
            position: absolute;
            width: 2px;
            background-color: #0057b7;
        }

        .connector-left-vertical {
            right: calc(50% + 85px);
            height: 32px;
            top: calc(50% - 16px);
        }

        .connector-right-vertical {
            left: calc(50% + 85px);
            height: 32px;
            top: calc(50% - 16px);
        }

        .round-label {
            position: absolute;
            font-size: 9px;
            color: #666;
        }

        .final-four-label-left {
            left: calc(50% - 130px);
            top: -10px;
        }

        .final-four-label-right {
            right: calc(50% - 130px);
            top: -10px;
        }

        .championship-label {
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
        }

        /* Make connectors more prominent between regions and final four */
        .connector-line {
            position: absolute;
            background-color: #0057b7;
            z-index: 10;
        }

        /* Customizing jquery-bracket styles for a more compact view */
        .jQBracket {
            font-size: 10px !important;
            font-family: 'Arial', sans-serif !important;
        }

        .jQBracket .team {
            background-color: #f5f8ff !important;
            padding: 2px 4px !important;
            height: auto !important;
            min-height: 14px !important;
            margin-bottom: 1px !important;
            cursor: pointer !important;
            transition: background-color 0.2s ease !important;
        }

        .jQBracket .team:hover {
            background-color: #e3f2fd !important;
        }

        .jQBracket .team.win {
            background-color: #e3f2fd !important;
            border-left: 2px solid #0057b7 !important;
            font-weight: bold !important;
        }

        .jQBracket .connector {
            border-color: #0057b7 !important;
        }

        .jQBracket .teamContainer {
            height: auto !important;
        }

        .jQBracket .round {
            margin-top: 2px !important;
            margin-bottom: 2px !important;
        }

        .jQBracket .matchContainer {
            padding: 0 !important;
            margin-top: -1px !important;
        }

        .jQBracket .label {
            color: #666 !important;
            font-size: 9px !important;
        }

        /* Fix for right-to-left brackets */
        .jQBracket.rl .connector.filled {
            border-color: #0057b7 !important;
        }

        .jQBracket.rl .team.win {
            border-right: 2px solid #0057b7 !important;
            border-left: none !important;
        }

        /* Unified center bracket for Final Four */
        .center-bracket {
            max-width: 400px;
        }

        .buttons-container {
            display: flex;
            justify-content: center;
            margin-top: 15px;
            gap: 10px;
        }

        .btn {
            background-color: #0057b7;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.2s;
        }

        .btn:hover {
            background-color: #003d82;
        }

        .btn-reset {
            background-color: #6c757d;
        }

        .btn-reset:hover {
            background-color: #5a6268;
        }

        #save-message {
            text-align: center;
            margin-top: 5px;
            font-size: 11px;
            color: #28a745;
            min-height: 15px;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>NCAA March Madness Bracket</h1>
        </header>
        <div class="instructions">
            Click on teams to advance them through the bracket. Pick your champion by clicking all the way through to
            the final game.
        </div>

        <div class="tournament-container">
            <!-- West Region (top left) -->
            <div class="west-region">
                <h2 class="region-title">West Region</h2>
                <div id="west-bracket" class="bracket"></div>
            </div>

            <!-- East Region (top right) -->
            <div class="east-region">
                <h2 class="region-title">East Region</h2>
                <div id="east-bracket" class="bracket"></div>
            </div>

            <!-- Center area with Final Four and Championship -->
            <div class="center-area">
                <div class="final-four-layout">
                    <!-- Final Four Labels -->
                    <div class="round-label final-four-label-left">Final Four</div>
                    <div class="round-label championship-label">Championship</div>
                    <div class="round-label final-four-label-right">Final Four</div>

                    <!-- Left side matchup (East vs West) -->
                    <div class="final-four-matchup left">
                        <div class="final-four-team east-winner" data-region="east">
                            <span class="seed"></span>
                            <span class="name">East Region</span>
                        </div>
                        <div class="final-four-team west-winner" data-region="west">
                            <span class="seed"></span>
                            <span class="name">West Region</span>
                        </div>
                    </div>

                    <!-- Championship matchup -->
                    <div class="championship-matchup">
                        <div class="final-four-team left-winner">
                            <span class="seed"></span>
                            <span class="name">TBD</span>
                        </div>
                        <div class="final-four-team right-winner">
                            <span class="seed"></span>
                            <span class="name">TBD</span>
                        </div>
                        <div class="champion-display" style="display: none;">
                            <span class="champion-name">Champion</span>
                        </div>
                    </div>

                    <!-- Right side matchup (South vs Midwest) -->
                    <div class="final-four-matchup right">
                        <div class="final-four-team south-winner right" data-region="south">
                            <span class="seed"></span>
                            <span class="name">South Region</span>
                        </div>
                        <div class="final-four-team midwest-winner right" data-region="midwest">
                            <span class="seed"></span>
                            <span class="name">Midwest Region</span>
                        </div>
                    </div>

                    <!-- Connector lines -->
                    <div class="connector-horizontal connector-left"></div>
                    <div class="connector-horizontal connector-right"></div>
                    <div class="connector-vertical connector-left-vertical"></div>
                    <div class="connector-vertical connector-right-vertical"></div>
                </div>
            </div>

            <!-- South Region (bottom left) -->
            <div class="south-region">
                <h2 class="region-title">South Region</h2>
                <div id="south-bracket" class="bracket"></div>
            </div>

            <!-- Midwest Region (bottom right) -->
            <div class="midwest-region">
                <h2 class="region-title">Midwest Region</h2>
                <div id="midwest-bracket" class="bracket"></div>
            </div>
        </div>

        <div class="buttons-container">
            <button id="save-bracket" class="btn">Save Bracket</button>
            <button id="reset-bracket" class="btn btn-reset">Reset Bracket</button>
        </div>
        <div id="save-message"></div>
    </div>

    <script>
        $(document).ready(function () {
            // Generate teams for each region
            function generateTeams(region) {
                // Define 2024 March Madness teams by region
                const teamsByRegion = {
                    'East': [
                        { name: 'UConn', seed: 1 },
                        { name: 'Iowa State', seed: 2 },
                        { name: 'Illinois', seed: 3 },
                        { name: 'Auburn', seed: 4 },
                        { name: 'San Diego State', seed: 5 },
                        { name: 'BYU', seed: 6 },
                        { name: 'Washington State', seed: 7 },
                        { name: 'FAU', seed: 8 },
                        { name: 'Northwestern', seed: 9 },
                        { name: 'Drake', seed: 10 },
                        { name: 'Duquesne', seed: 11 },
                        { name: 'UAB', seed: 12 },
                        { name: 'Yale', seed: 13 },
                        { name: 'Morehead State', seed: 14 },
                        { name: 'South Dakota State', seed: 15 },
                        { name: 'Stetson', seed: 16 }
                    ],
                    'West': [
                        { name: 'North Carolina', seed: 1 },
                        { name: 'Arizona', seed: 2 },
                        { name: 'Baylor', seed: 3 },
                        { name: 'Alabama', seed: 4 },
                        { name: "Saint Mary's", seed: 5 },
                        { name: 'Clemson', seed: 6 },
                        { name: 'Dayton', seed: 7 },
                        { name: 'Mississippi State', seed: 8 },
                        { name: 'Michigan State', seed: 9 },
                        { name: 'Nevada', seed: 10 },
                        { name: 'New Mexico', seed: 11 },
                        { name: 'Grand Canyon', seed: 12 },
                        { name: 'Charleston', seed: 13 },
                        { name: 'Colgate', seed: 14 },
                        { name: 'Long Beach State', seed: 15 },
                        { name: 'Wagner', seed: 16 }
                    ],
                    'South': [
                        { name: 'Houston', seed: 1 },
                        { name: 'Marquette', seed: 2 },
                        { name: 'Kentucky', seed: 3 },
                        { name: 'Duke', seed: 4 },
                        { name: 'Wisconsin', seed: 5 },
                        { name: 'Texas Tech', seed: 6 },
                        { name: 'Florida', seed: 7 },
                        { name: 'Nebraska', seed: 8 },
                        { name: 'Texas A&M', seed: 9 },
                        { name: 'Colorado', seed: 10 },
                        { name: 'NC State', seed: 11 },
                        { name: 'James Madison', seed: 12 },
                        { name: 'Vermont', seed: 13 },
                        { name: 'Oakland', seed: 14 },
                        { name: 'Western Kentucky', seed: 15 },
                        { name: 'Longwood', seed: 16 }
                    ],
                    'Midwest': [
                        { name: 'Purdue', seed: 1 },
                        { name: 'Tennessee', seed: 2 },
                        { name: 'Creighton', seed: 3 },
                        { name: 'Kansas', seed: 4 },
                        { name: 'Gonzaga', seed: 5 },
                        { name: 'South Carolina', seed: 6 },
                        { name: 'Texas', seed: 7 },
                        { name: 'Utah State', seed: 8 },
                        { name: 'TCU', seed: 9 },
                        { name: 'Virginia', seed: 10 },
                        { name: 'Oregon', seed: 11 },
                        { name: 'McNeese', seed: 12 },
                        { name: 'Samford', seed: 13 },
                        { name: 'Akron', seed: 14 },
                        { name: "Saint Peter's", seed: 15 },
                        { name: 'Montana State', seed: 16 }
                    ]
                };

                const regionTeams = teamsByRegion[region];

                // Create the matchups in the correct format for jquery-bracket
                const teams = [];
                // First Round: 1 vs 16, 8 vs 9, etc.
                teams.push([regionTeams[0].seed + '. ' + regionTeams[0].name, regionTeams[15].seed + '. ' + regionTeams[15].name]);
                teams.push([regionTeams[7].seed + '. ' + regionTeams[7].name, regionTeams[8].seed + '. ' + regionTeams[8].name]);
                teams.push([regionTeams[4].seed + '. ' + regionTeams[4].name, regionTeams[11].seed + '. ' + regionTeams[11].name]);
                teams.push([regionTeams[3].seed + '. ' + regionTeams[3].name, regionTeams[12].seed + '. ' + regionTeams[12].name]);
                teams.push([regionTeams[5].seed + '. ' + regionTeams[5].name, regionTeams[10].seed + '. ' + regionTeams[10].name]);
                teams.push([regionTeams[2].seed + '. ' + regionTeams[2].name, regionTeams[13].seed + '. ' + regionTeams[13].name]);
                teams.push([regionTeams[6].seed + '. ' + regionTeams[6].name, regionTeams[9].seed + '. ' + regionTeams[9].name]);
                teams.push([regionTeams[1].seed + '. ' + regionTeams[1].name, regionTeams[14].seed + '. ' + regionTeams[14].name]);

                // Create empty results array for the bracket
                const results = [[], [], [], []];

                return { teams: teams, results: results };
            }

            // Initialize regional brackets
            let regionWinners = {};
            let finalFourWinners = {
                left: null,
                right: null,
                champion: null
            };

            // Create a custom render function for team display
            function renderTeam(container, team, score) {
                if (team) {
                    container.text(''); // Clear existing content
                    container.append(document.createTextNode(team));
                }
            }

            // West and South go left to right
            $('#west-bracket').bracket({
                skipConsolationRound: true,
                teamWidth: 100,
                scoreWidth: 0,
                matchMargin: 15,
                roundMargin: 20,
                centerConnectors: true,
                disableHighlight: false,
                disableTeamEdit: true,
                disableToolbar: true,
                disableScoreEdit: true,
                init: generateTeams('West'),
                save: function (data) {
                    handleRegionWinner('west', data);
                },
                decorator: {
                    edit: function () { return ""; },
                    render: renderTeam
                }
            });

            $('#south-bracket').bracket({
                skipConsolationRound: true,
                teamWidth: 100,
                scoreWidth: 0,
                matchMargin: 15,
                roundMargin: 20,
                centerConnectors: true,
                disableHighlight: false,
                disableTeamEdit: true,
                disableToolbar: true,
                disableScoreEdit: true,
                init: generateTeams('South'),
                save: function (data) {
                    handleRegionWinner('south', data);
                },
                decorator: {
                    edit: function () { return ""; },
                    render: renderTeam
                }
            });

            // East and Midwest go right to left
            $('#east-bracket').bracket({
                skipConsolationRound: true,
                teamWidth: 100,
                scoreWidth: 0,
                matchMargin: 15,
                roundMargin: 20,
                centerConnectors: true,
                disableHighlight: false,
                disableTeamEdit: true,
                disableToolbar: true,
                disableScoreEdit: true,
                dir: "rl",
                init: generateTeams('East'),
                save: function (data) {
                    handleRegionWinner('east', data);
                },
                decorator: {
                    edit: function () { return ""; },
                    render: renderTeam
                }
            });

            $('#midwest-bracket').bracket({
                skipConsolationRound: true,
                teamWidth: 100,
                scoreWidth: 0,
                matchMargin: 15,
                roundMargin: 20,
                centerConnectors: true,
                disableHighlight: false,
                disableTeamEdit: true,
                disableToolbar: true,
                disableScoreEdit: true,
                dir: "rl",
                init: generateTeams('Midwest'),
                save: function (data) {
                    handleRegionWinner('midwest', data);
                },
                decorator: {
                    edit: function () { return ""; },
                    render: renderTeam
                }
            });

            // Handler for region winners
            function handleRegionWinner(region, data) {
                // Check for results in all rounds and update accordingly
                if (data.results && data.results.length > 0) {
                    // Process all rounds - the last round (Elite 8) determines the region winner
                    const lastRoundIndex = data.results.length - 1;

                    // If we have a region winner (Elite 8 result)
                    if (data.results[lastRoundIndex] && data.results[lastRoundIndex][0] !== undefined) {
                        const winnerIdx = data.results[lastRoundIndex][0];

                        // The winning team name from the data
                        let winnerTeam = '';

                        // Try to find the winning team by tracing back through rounds
                        if (lastRoundIndex > 0 && data.results[lastRoundIndex - 1] && data.results[lastRoundIndex - 1][winnerIdx * 2] !== undefined) {
                            // Get from the previous round
                            const previousRoundIdx = winnerIdx * 2;
                            const teamIdx = data.results[lastRoundIndex - 1][previousRoundIdx];

                            // If we're still not at the first round, keep working back
                            if (lastRoundIndex > 1 && data.results[lastRoundIndex - 2] && data.results[lastRoundIndex - 2][teamIdx * 2] !== undefined) {
                                const secondPrevRoundIdx = teamIdx * 2;
                                const firstRoundTeamIdx = data.results[lastRoundIndex - 2][secondPrevRoundIdx];

                                // Now we can get the team from the first round
                                if (data.teams && data.teams[firstRoundTeamIdx]) {
                                    winnerTeam = data.teams[firstRoundTeamIdx][0];
                                }
                            } else if (data.teams && data.teams[teamIdx]) {
                                // If we're at the second round
                                winnerTeam = data.teams[teamIdx][0];
                            }
                        } else if (data.teams && data.teams[winnerIdx]) {
                            // If we're at the first round
                            winnerTeam = data.teams[winnerIdx][0];
                        }

                        // Fallback if we couldn't trace through rounds
                        if (!winnerTeam && data.teams) {
                            // Try to search all teams for a match
                            for (let i = 0; i < data.teams.length; i++) {
                                // Check if this is the winning team in the final round
                                const maybeWinner = data.teams[i][data.results[0][i]];
                                if (maybeWinner && maybeWinner.includes(region)) {
                                    winnerTeam = maybeWinner;
                                    break;
                                }
                            }
                        }

                        // Extract team info
                        if (winnerTeam) {
                            // Parse "1. North Carolina" format
                            const teamParts = winnerTeam.split('.');
                            const winnerSeed = parseInt(teamParts[0]);
                            const winnerName = teamParts[1] ? teamParts[1].trim() : region.charAt(0).toUpperCase() + region.slice(1);

                            regionWinners[region] = {
                                name: winnerName,
                                seed: winnerSeed,
                                fullName: winnerTeam,
                                region: region.charAt(0).toUpperCase() + region.slice(1)
                            };

                            // Update the Final Four display
                            updateFinalFourDisplay();
                        }
                    }
                }
            }

            // Update the Final Four display with winners from the regions
            function updateFinalFourDisplay() {
                // Update East winner
                if (regionWinners.east) {
                    $('.east-winner').html(
                        `<span class="seed">${regionWinners.east.seed}</span> ` +
                        `<span class="name">${regionWinners.east.name}</span>`
                    );
                }

                // Update West winner
                if (regionWinners.west) {
                    $('.west-winner').html(
                        `<span class="seed">${regionWinners.west.seed}</span> ` +
                        `<span class="name">${regionWinners.west.name}</span>`
                    );
                }

                // Update South winner
                if (regionWinners.south) {
                    $('.south-winner').html(
                        `<span class="seed">${regionWinners.south.seed}</span> ` +
                        `<span class="name">${regionWinners.south.name}</span>`
                    );
                }

                // Update Midwest winner
                if (regionWinners.midwest) {
                    $('.midwest-winner').html(
                        `<span class="seed">${regionWinners.midwest.seed}</span> ` +
                        `<span class="name">${regionWinners.midwest.name}</span>`
                    );
                }
            }

            // Add click handlers for Final Four teams
            $('.final-four-team.east-winner, .final-four-team.west-winner').click(function () {
                const region = $(this).data('region');

                // Don't do anything if region winner is not set yet
                if (!regionWinners[region]) return;

                // Remove winner class from both teams
                $('.final-four-team.east-winner, .final-four-team.west-winner').removeClass('winner');

                // Add winner class to clicked team
                $(this).addClass('winner');

                // Store the winner and update championship
                finalFourWinners.left = region;
                updateChampionshipTeams();
            });

            $('.final-four-team.south-winner, .final-four-team.midwest-winner').click(function () {
                const region = $(this).data('region');

                // Don't do anything if region winner is not set yet
                if (!regionWinners[region]) return;

                // Remove winner class from both teams
                $('.final-four-team.south-winner, .final-four-team.midwest-winner').removeClass('winner');

                // Add winner class to clicked team
                $(this).addClass('winner');

                // Store the winner and update championship
                finalFourWinners.right = region;
                updateChampionshipTeams();
            });

            // Update championship teams
            function updateChampionshipTeams() {
                // Update left side championship team
                if (finalFourWinners.left && regionWinners[finalFourWinners.left]) {
                    $('.left-winner').html(
                        `<span class="seed">${regionWinners[finalFourWinners.left].seed}</span> ` +
                        `<span class="name">${regionWinners[finalFourWinners.left].name}</span>`
                    );
                }

                // Update right side championship team
                if (finalFourWinners.right && regionWinners[finalFourWinners.right]) {
                    $('.right-winner').html(
                        `<span class="seed">${regionWinners[finalFourWinners.right].seed}</span> ` +
                        `<span class="name">${regionWinners[finalFourWinners.right].name}</span>`
                    );
                }
            }

            // Add click handlers for Championship teams
            $('.left-winner, .right-winner').click(function () {
                const isLeft = $(this).hasClass('left-winner');
                const side = isLeft ? 'left' : 'right';

                // Don't do anything if final four winner is not set yet
                if (!finalFourWinners[side] || !regionWinners[finalFourWinners[side]]) return;

                // Remove winner class from both teams
                $('.left-winner, .right-winner').removeClass('winner');

                // Add winner class to clicked team
                $(this).addClass('winner');

                // Store the champion and update display
                finalFourWinners.champion = finalFourWinners[side];
                updateChampion();
            });

            // Update champion display
            function updateChampion() {
                if (finalFourWinners.champion && regionWinners[finalFourWinners.champion]) {
                    $('.champion-display').show();
                    $('.champion-name').html(
                        `CHAMPION:<br>${regionWinners[finalFourWinners.champion].seed} ${regionWinners[finalFourWinners.champion].name}`
                    );
                }
            }

            // Set round labels with more compact text
            $('.west-region .jQBracket .label, .east-region .jQBracket .label, .south-region .jQBracket .label, .midwest-region .jQBracket .label').each(function (i) {
                if (i === 0) $(this).text('1st Rd');
                if (i === 1) $(this).text('2nd Rd');
                if (i === 2) $(this).text('Sweet 16');
                if (i === 3) $(this).text('Elite 8');
            });

            // Load saved bracket if available
            loadSavedBracket();

            // Save bracket handler
            $('#save-bracket').click(function () {
                saveBracketToStorage();
            });

            // Reset bracket handler
            $('#reset-bracket').click(function () {
                if (confirm('Are you sure you want to reset your bracket? All picks will be cleared.')) {
                    localStorage.removeItem('ncaaBracketData');
                    location.reload();
                }
            });

            // Function to save bracket data to localStorage
            function saveBracketToStorage() {
                // Get data from all regional brackets
                const bracketData = {
                    west: $('#west-bracket').bracket('data'),
                    east: $('#east-bracket').bracket('data'),
                    south: $('#south-bracket').bracket('data'),
                    midwest: $('#midwest-bracket').bracket('data'),
                    finalFourWinners: finalFourWinners,
                    regionWinners: regionWinners
                };

                try {
                    localStorage.setItem('ncaaBracketData', JSON.stringify(bracketData));
                    $('#save-message').text('Bracket saved successfully!');
                    setTimeout(() => {
                        $('#save-message').text('');
                    }, 3000);
                } catch (e) {
                    console.error('Error saving bracket data:', e);
                    $('#save-message').text('Error saving bracket data!');
                }
            }

            // Function to load bracket data from localStorage
            function loadSavedBracket() {
                try {
                    const savedData = localStorage.getItem('ncaaBracketData');
                    if (savedData) {
                        const bracketData = JSON.parse(savedData);

                        // Restore regional brackets
                        if (bracketData.west) {
                            $('#west-bracket').bracket('reload', bracketData.west);
                            handleRegionWinner('west', bracketData.west);
                        }

                        if (bracketData.east) {
                            $('#east-bracket').bracket('reload', bracketData.east);
                            handleRegionWinner('east', bracketData.east);
                        }

                        if (bracketData.south) {
                            $('#south-bracket').bracket('reload', bracketData.south);
                            handleRegionWinner('south', bracketData.south);
                        }

                        if (bracketData.midwest) {
                            $('#midwest-bracket').bracket('reload', bracketData.midwest);
                            handleRegionWinner('midwest', bracketData.midwest);
                        }

                        // Restore Final Four selections
                        if (bracketData.finalFourWinners && bracketData.regionWinners) {
                            regionWinners = bracketData.regionWinners;
                            finalFourWinners = bracketData.finalFourWinners;

                            // Update displays
                            updateFinalFourDisplay();

                            // Add winner classes to Final Four teams
                            if (finalFourWinners.left) {
                                $(`.final-four-team.${finalFourWinners.left}-winner`).addClass('winner');
                            }

                            if (finalFourWinners.right) {
                                $(`.final-four-team.${finalFourWinners.right}-winner`).addClass('winner');
                            }

                            // Update championship teams
                            updateChampionshipTeams();

                            // If we have a champion, select them
                            if (finalFourWinners.champion) {
                                const side = finalFourWinners.champion === finalFourWinners.left ? 'left' : 'right';
                                $(`.${side}-winner`).addClass('winner');
                                updateChampion();
                            }
                        }
                    }
                } catch (e) {
                    console.error('Error loading saved bracket:', e);
                }
            }
        });
    </script>
</body>

</html>